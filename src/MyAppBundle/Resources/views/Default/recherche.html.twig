<script type="text/javascript">
 function lancer_recherche_filtre(){
           $("#ajax_result").html('<img height="15" src="{{ asset('uploads/images/30.GIF') }}">');
           $.ajax({url: "{{  path('my_app_recherche_filtre') }}?"+$('form[name="app_homebundle_filtre_produit"]').serialize(), success: function(result){
             $("#my_ajax_result").html(result);
             }}); 
 };   
 $(document).ready(function() {
     $(".ajax_bt_filter_produit").click(function(){
     lancer_recherche_filtre();   
     });
     
     $('.datepicker').datepicker({
    dateFormat: 'yy-mm-dd'
    });
 });    
</script>
{% set counter_avis = 0 %}
{% for entity in listproducts %}
  {% set counter_avis = entity.getAvis().count() + counter_avis %}
{% endfor %}   
<h4>RESULTAT DU RECHERCHE ({{ counter_avis }} avis ) </h4>
    <div>
       <h2>Critères de recherche</h2>
     {% if category_name!='' %}Catégorie : <span class="label label-success">{{ category_name }}</span>{% endif %}
     {% if sub_category_name!='' %}<br /><br />Sous catégorie : <span class="label label-success">{{ sub_category_name }}</span>{% endif %}
     {% if texte_nom_produit!='' %}<br /><br />Texte nom produit :<span class="label label-success">{{ texte_nom_produit }}</span>{% endif %}
   </div>
   <div class="row">
    {{ form_start(form_filter, {'action': path('my_app_recherche_filtre'), 'method': 'GET'}) }}
         <div class="col-md-4">
             <div class="row">
               <div class="col-md-8">
                 {{ form_label(form_filter.presentation, "Présentation", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.presentation) }}
               </div>   
               <div class="col-md-4">
                {{ form_widget(form_filter.presentation, {'attr': {'class': 'form-control'}}) }}
               </div>
             </div>
             <div class="row">    
               <div class="col-md-8">
                 {{ form_label(form_filter.texture, "Texture", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.texture) }}
             </div>   
               <div class="col-md-4">
                {{ form_widget(form_filter.texture, {'attr': {'class': 'form-control'}}) }}
             </div>
             </div>
             <div class="row">    
               <div class="col-md-8">
                 {{ form_label(form_filter.penetration, "Pénétration", {'label_attr': {'class': ' control-label'}}) }}
                 {{ form_errors(form_filter.penetration) }}
             </div>        
               <div class="col-md-4">
                {{ form_widget(form_filter.penetration, {'attr': {'class': 'form-control'}}) }}
             </div>
             </div>
             <div class="row">    
               <div class="col-md-8">
                 {{ form_label(form_filter.efficacite_long_terme, "Efficacité à long terme", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.efficacite_long_terme) }}
             </div>   
               <div class="col-md-4">
                {{ form_widget(form_filter.efficacite_long_terme, {'attr': {'class': 'form-control'}}) }}
             </div>
             </div>        
         </div>
         <div class="col-md-4">
             <div class="row">
               <div class="col-md-8">
                 {{ form_label(form_filter.efficacite_court_terme, "Efficacité à court terme", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.efficacite_court_terme) }}
             </div>   
               <div class="col-md-4">
                {{ form_widget(form_filter.efficacite_court_terme, {'attr': {'class': 'form-control'}}) }}
             </div>
             </div>
             <div class="row">    
               <div class="col-md-8">
                 {{ form_label(form_filter.odeur, "Odeur", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.odeur) }}
             </div>   
               <div class="col-md-4">
                {{ form_widget(form_filter.odeur, {'attr': {'class': 'form-control'}}) }}
             </div>
             </div>
             <div class="row">    
               <div class="col-md-8">
                 {{ form_label(form_filter.qualite_prix, "Qualite/Prix", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.qualite_prix) }}
             </div>   
               <div class="col-md-4">
                {{ form_widget(form_filter.qualite_prix, {'attr': {'class': 'form-control'}}) }}
             </div>
             </div>        
         </div>
         <div class="col-md-4">
             <div>
             <div class="col-md-2"><label class="control-label">Prix</label></div>
             <div class="col-md-10">
                 <div class="col-md-2">Entre</div>
                 <div class="col-md-4">
                    {{ form_errors(form_filter.prix_min) }}
                    {{ form_widget(form_filter.prix_min, {'attr': {'class': 'form-control','placeholder':'4 €','autocomplete':'off'}}) }}
                 </div>
                 <div class="col-md-2">Et</div>
                 <div class="col-md-4">
                    {{ form_errors(form_filter.prix_max) }}
                    {{ form_widget(form_filter.prix_max, {'attr': {'class': 'form-control','placeholder':'8 €','autocomplete':'off'}}) }}
              
                 </div>                  
             </div>
             </div>
            <div class="clearfix"></div>  
             <div>
                 <div class="col-md-2">
                   <label class="control-label">Date:</label>
                 </div>
                 <div class="col-md-10">    
                  {{ form_widget(form_filter.date_a, {'attr': {'class': 'input_date datepicker','placeholder':'2011-11-02'}}) }}
                  à
                  {{ form_widget(form_filter.date_b, {'attr': {'class': 'input_date datepicker','placeholder':'2011-11-02'}}) }}
                  </div>
                     </div>
             <div class="clearfix"></div>   
             <div class="col-md-8">
                 {{ form_label(form_filter.commentaires, "Commentaires", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.commentaires) }}
             </div>   
             <div class="col-md-4">
                {{ form_widget(form_filter.commentaires, {'attr': {'class': 'form-control'}}) }}
             </div>
             <div class="col-md-8">
                 {{ form_label(form_filter.points_forts, "Points forts", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.points_forts) }}
             </div>   
             <div class="col-md-4">
                {{ form_widget(form_filter.points_forts, {'attr': {'class': 'form-control'}}) }}
             </div> 
             <div class="col-md-8">
                 {{ form_label(form_filter.points_faibles, "Points faibles", {'label_attr': {'class': 'control-label'}}) }}
                 {{ form_errors(form_filter.points_faibles) }}
             </div>   
             <div class="col-md-4">
                {{ form_widget(form_filter.points_faibles, {'attr': {'class': 'form-control'}}) }}
             </div>    
         </div>   
         <input type="hidden" name="categoire" value="{{ app.request.get('app_homebundle_beaute_search')['categorie'] }}" />
         <input type="hidden" name="sub_categorie" value="{{ app.request.get('app_homebundle_beaute_search')['sub_categorie'] }}" />
         <input type="hidden" name="product_name" value="{{ app.request.get('app_homebundle_beaute_search')['product_name'] }}" />
         <input type="hidden" name="marque" value="{{ app.request.get('app_homebundle_beaute_search')['marque'] }}" />
    {{ form_rest(form_filter) }}
         <div class="col-md-12">
           <input type="button" value="Filtre" class="ajax_bt_filter_produit btn btn-primary">
           <input type="submit" class="btn btn-primary" value="filtrer" />
         </div>
    </form>
    </div>
<div class="clearfix"></div>
 {% set size = listproducts | length %}
<div id="my_ajax_result">
{% set size = listproducts | length %}
 {% set size_avis = avis | length %}               
 <ul id="tabs_result" class="nav nav-tabs" data-tabs="tabs">
        <li class="active"><a href="#my_results_produits" data-toggle="tab">Liste des produits ({{ listproducts.getTotalItemCount }})</a></li>
        <li><a href="#my_results_avis" data-toggle="tab">Liste avis ({{ size_avis }})</a></li>
    </ul>
    <div id="my-tab-content_result" class="tab-content">
        <div class="tab-pane active" id="my_results_produits">
       
 
<div id="ajax_result">
<div class="content_result">
<div id="my_pagination_ajax"> 
    <h2>*Liste des produits ({{ listproducts.getTotalItemCount }})</h2>
<table class="table table-bordered table-striped table-condensed">
            <thead>
              <tr>
                <th>Marque</th>
                <th>Nom</th>
                <th>Nombre d'avis Total</th>
                <th>Nombre d'avis sans commentaire</th>
                <th>&nbsp;</th>
              </tr>
            </thead>
            <tbody>
              {% for entity in listproducts %}
               <tr>
                   <td>{{ entity.marque }}</td>
                   <td>{{ entity.name }}</td>
                   <td>{{ entity.getAvis().count() }}</td>
                   <td>{{ entity.get_Nb_Avis_Sans_Commentaires() }}</td>
                   <td><a target="_blanc" href="{{ path('my_app_affiche_avis_produit', { 'id': entity.id }) }}">Consulter les avis</a></td>
               </tr>
              {% endfor %}     
            </tbody>
</table>
        <div class="navigation">
    {{ knp_pagination_render(listproducts) }}
</div>
</div>
  
</div>
</div></h1>
        </div>            
        <div class="tab-pane" id="my_results_avis">
            <h2>Liste avis ({{ size_avis }})</h2>
            <table class="table table-bordered table-striped table-condensed">
            <thead>
              <tr>
                <th>Produit</th>
                <th>Marque</th>
                <th>Catégorie</th>
                <th>Sous catégorie</th>
                <th>Prix</th>
                <th>Contenance</th>
                <th>Genre</th>
                <th>Age</th>
                <th>Points forts</th>
                <th>points faibles</th>
                <th>Commentaire</th>
              </tr>
            </thead>
            <tbody>
               {% for one_avis in avis %}     
                <tr>
                   <td>{{ one_avis.getProduct().name }}</td>
                   <td>{{ one_avis.getProduct().marque }}</td>
                   <td>{{ category_name }}</td>
                   <td>{{ one_avis.getProduct().getCategory().name }}</td>
                   <td>{{ one_avis.getProduct().prix }}</td>
                   <td>{{ one_avis.getProduct().getCont() }}</td>
                   <td>{{ one_avis.getGender() }}</td>
                   <td>{{ one_avis.getCritere() }}</td>
                   <td>{{ one_avis.getPointsForts() }}</td>
                   <td>{{ one_avis.getPointsFaibles() }}</td>
                   <td>{{ one_avis.comments }}</td>
                </tr>
               {% endfor %}      
            </tbody>
</table> 
        </div>
   </div>              
</div> 
  <div>
    <br><a href="http://{{ app.request.server.get('SERVER_NAME') }}/{{ asset('uploads/csv_critere_'~app.user.username~'.csv') }}" targuet="_blanc">CSV produits et critères</a>
    <br><a href="http://{{ app.request.server.get('SERVER_NAME') }}/{{ asset('uploads/csv_points_forts_'~app.user.username~'.csv') }}" targuet="_blanc">CSV produits et points forts</a>
    <br><a href="http://{{ app.request.server.get('SERVER_NAME') }}/{{ asset('uploads/csv_points_faibles_'~app.user.username~'.csv') }}" targuet="_blanc">CSV produits et points faibles</a>
   </div>   


